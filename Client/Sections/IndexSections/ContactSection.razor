@using System.Text;
@using System.Net.Mime;
@inject HttpClient Http

<SectionBase Id=@Id BGLighter=@BGLighter>
	<BigMudPaper>
		<MudStack AlignItems="AlignItems.Center" Class="spaced-block">
			<ResponsiveTitle>Get in Touch</ResponsiveTitle>
			<MudText Align="Align.Center">I’m always available for contact, whether you have questions or an exciting opportunity. Please don’t hesitate to contact me.</MudText>

			<MudButton Disabled=@Sending Variant="Variant.Filled" Color="Color.Secondary" OnClick=SendEmail>Contact</MudButton>

			<SocialMedia />
		</MudStack>
	</BigMudPaper>
</SectionBase>

@code {
	[Parameter]
	public string? Id { get; set; }
	[Parameter]
	public bool BGLighter { get; set; }

	private bool Sending { get; set; }

	async Task SendEmail()
	{
		Sending = true;
		try
		{
			ContactMessage message = new()
				{
					Name = "test",
					Email = "test@WilliamSullivan.dev",
					Message = "test",
				};

			var response = await Http.PostAsJsonAsync("/api/SendMessage", message) ?? new() { };
			if (response.IsSuccessStatusCode)
			{
				var contactResponse = await response.Content.ReadFromJsonAsync<ContactResponse>();
			}
			else
			{
				Console.WriteLine(await response.Content.ReadAsStringAsync());
			}
		}
		catch (Exception ex)
		{
			Console.WriteLine(ex.ToString());
		}
		Sending = false;
	}
}
